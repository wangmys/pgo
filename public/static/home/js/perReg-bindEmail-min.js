var emailAliasValidObj={methodName:"emailAlias",elementId:"#emailAlias",messageId:"#emailAliasTip",isEmptyHighlight:true};var emailCodeValidObj={methodName:"emailCode",elementId:"#emailCode",messageId:"#emailCodeTip",isEmptyHighlight:true,emailId:"#emailAlias",scen:"PERSON_EMAIL_REG_VERIFY_EMAIL"};function cleanInputStyle(a){if($(a).next(".ms-ico").size()>0){$(a).next(".ms-ico").remove()}$(a).parents(".error-border").removeClass("error-border")}function showInputSuccessStyle(a){if($(a).next(".ms-ico").size()>0){$(a).next(".ms-ico").remove()}if(!$(a).is("input[type=checkbox]")){$(a).after('<i class="ms-ico ms-ico-ok"></i>')}$(a).parents(".error-border").removeClass("error-border")}function showInputErrorStyle(a){if($(a).next(".ms-ico").size()>0){$(a).next(".ms-ico").remove()}if(!$(a).is("input[type=checkbox]")){$(a).after('<i class="ms-ico ms-ico-error"></i>')}$(a).parents(".reg-txtbox,.code-txtbox").addClass("error-border")}function showTipNormalStyle(a,b){$(a).html(b).removeClass("tip-error-color")}function showTipErrorStyle(a,b){$(a).html(b).addClass("tip-error-color")}function showErrorBox(b,a){if(!a){$("#step"+b+" .error-box").addClass("hide");$("#step"+b+" .error-box span").html("");return}$("#step"+b+" .error-box").removeClass("hide");$("#step"+b+" .error-box span").html(a)}var emailCodeTip="";$(function(){srsval.init({baseurl:$("#baseUrl").val(),highlight:function(f,e,g,d){var b=f.elementId;var c=f.messageId;var a=f.isEmptyHighlight;if(!a&&g=="__empty"){if($(c).hasClass("tip-error-color")){showTipNormalStyle(c,"")}cleanInputStyle(b);return}showInputErrorStyle(b);switch(b){case"#emailCode":if(g=="1103"){showErrorBox(22,d);showTipNormalStyle("#emailCodeTip","");cleanInputStyle("#emailCode");$("#emailCode").val("");return}}showTipErrorStyle(c,d)},unhighlight:function(e,d,f,c){var a=e.elementId;var b=e.messageId;switch(a){}showTipNormalStyle(b,"");showInputSuccessStyle(a)},errorMessage_emailAlias_exist:"该邮箱已存在，请重新输入"});$("#emailAlias").focus(function(){showTipNormalStyle("#emailAliasTip","");cleanInputStyle("#emailAlias")}).blur(function(){if($("#emailAlias").data("canntBlur")){return}srsval.valid({validObjs:[emailAliasValidObj]})}).keyup(function(a){if(a.which==13&&$("#step1save").css("display")!="none"&&$(".yfb-account-pannel").css("display")=="none"){$("#step1save").trigger("click");return}});yfb.account();$(".yfb-account-pannel").live("mouseover",function(){$("#emailAlias").data("canntBlur",true)}).live("mouseout",function(){$("#emailAlias").data("canntBlur",false)});$("#emailCode").focus(function(){showTipNormalStyle("#emailCodeTip",emailCodeTip);cleanInputStyle("#emailCode")}).blur(function(){var a=$(this).val();if(a.length!=6){srsval.valid({validObjs:[$.extend({},emailAliasValidObj,{isAjaxCheck:false}),$.extend({},emailCodeValidObj,{isAjaxCheck:false,isEmptyHighlight:false})]})}}).keyup(function(b){if(b.which==13&&$("#step2save").css("display")!="none"){$("#step2save").trigger("click");return}var a=$(this).val();if(a.length==6){srsval.valid({validObjs:[$.extend({},emailAliasValidObj,{isAjaxCheck:false}),$.extend({},emailCodeValidObj,{isAjaxCheck:true,isEmptyHighlight:false})]})}});srscommon.bindEmailSendButton({sendButtonId:"#sendEmailCode",sendButtonDisableClass:"noActive",sendButtonEnableClass:"void-clazz",secondNum:60,vaildateDataFun:function(){if(!srsval.valid({validObjs:[emailAliasValidObj]})){return false}return true},getSendAjaxDataFun:function(){return{scen:"PERSON_EMAIL_REG_VERIFY_EMAIL",email:$("#emailAlias").val()}},sendCodeCallback:function(a,b,c){if("R0000"==a){var d=c.seqNum;$("#mseqNum").val(d);cleanInputStyle("#emailCode");showTipNormalStyle("#emailCodeTip",b);$("#emailCodeTip .emailTipDomainLink").attr("name","Preg_index_none_maillog");emailCodeTip="请输入序号为<em>"+d+"</em>的验证码"}else{if(null!=b&&""!=b){showTipNormalStyle("#emailCodeTip",b)}else{showTipNormalStyle("#emailCodeTip","发送失败")}}}});$("#step22save").click(function(){$("#step22save").hide();$("#step22saveing").show();if(!srsval.valid({validObjs:[emailAliasValidObj,emailCodeValidObj]})){$("#step22save").show();$("#step22saveing").hide();return}submitBindEmail(function(){$("#step22save").show();$("#step22saveing").hide()})})});function submitBindEmail(a){probeAuthStatus(function(){$.ajax({url:"/doBindEmail.do",type:"POST",data:getFormJson("#bind_form"),dataType:"json",async:false,success:function(b){if(b.result=="success"){location.href=$("#regsucc").attr("href")}else{showErrorBox(22,b.msg);a()}},error:function(){showErrorBox(22,"您的网络不给力，请稍候再试");a()}})},function(){logonUrl("","","")})};