var overseas=overseas||{};var isIE=!!window.ActiveXObject;var isIE6=isIE&&!window.XMLHttpRequest;overseas.flag=function(){var className=$("html").attr("class"),list=$(".gnav .nav li");if(className=="osmall"){list.eq(0).addClass("hot")}else{if(className=="osflash"){list.eq(1).addClass("hot")}}};overseas.hoverNav=function(){var navContainer=$(".nav-category");var navItem=navContainer.find("dl");var width=200;var width_origin=200;var all_nav=$(".gnav").find(".all");var close=$(".gnav").find(".close");navContainer.delegate("dl","mouseenter mouseleave",function(e){var _this=$(this);var index=_this.index();var nav_sub=_this.find(".nav-sub");if(e.type=="mouseenter"){navItem.removeClass("nav-hover").eq(index).addClass("nav-hover");_showSub(nav_sub)}else{if(e.type=="mouseleave"){_hideSub(nav_sub)}}});close.click(function(){_hideSub($(this).parent())});navContainer.mouseleave(function(){_hideNav()});all_nav.hover(function(){navContainer.show();$("#overheadSearchResults").hide()},function(){_hideNav(this);if(!$("html").hasClass("osmall")){navContainer.hide()}});function _hideNav(){navItem.removeClass("nav-hover");navContainer.find("dd").hide()}function _showSub(subMenu){subMenu.stop(true,true).show().animate({"width":width},200)}function _hideSub(subMenu){subMenu.animate({"width":0},200,function(){$(this).hide()})}};overseas.getNavs=function(){var container=$(".gnav");var mainNavContainer=container.find(".nav");var navs=container.find(".nav-category");var address="http://g.suning.com/";if(container.length==0){return}setSn();$.ajax({url:address+"commonHead-cmsDataCallback.jsonp",method:"get",dataType:"jsonp",jsonpCallback:"cmsDataCallback",cache:true,success:function(data){if(data){apendDOM(data);overseas.hoverNav();if(SFE){SFE.base.setSearchCity(".nav-category a")}}}});function getEnv(){var ego_pre_reg=/^(\w*)(pre)(\w*)(.cnsuning.com)$/,ego_sit_reg=/^(\w*)(sit)(\w*)(.cnsuning.com)$/,_hostName=window.location.hostname;if(ego_pre_reg.test(_hostName)){return"pre"}else{if(ego_sit_reg.test(_hostName)){return"sit"}}return"prd"}function setSn(){switch(getEnv()){case"prd":address="http://g.suning.com/";break;case"pre":address="http://gpre.cnsuning.com/";break;case"sit":address="http://gsit.cnsuning.com/";break}}function apendDOM(data){var mainNavs=data.commonWords.tag;var category=data.commonCategory.nodes;var otherWords=data.commonOther.tag;var str_mainNav="";var str_category="";if(category.length>0){for(var j=0;j<category.length;j++){var cate=category[j];var title=cate.tag;var cont=cate.nodes;str_category+="<dl>";str_category+="<dt>";if(title.length>0){var t=title[0]}if(cont.length>0){var c=cont[0].tag;str_category+='<p class="nav-category-list"><i class="category-icon category-icon'+j+'"></i>';str_category+="";var q=c.length>2?2:c.length;for(var m=0;m<q;m++){var child_t=c[m];str_category+='<a href="'+child_t.linkUrl+'" target="_blank" name="'+child_t.trickPoint+'">'+child_t.elementName+"</a>"}str_category+="</p>"}if(cont.length>1&&typeof(cont[1].nodes)!="undefined"){var child_category=cont[1].nodes;str_category+='<dd class="nav-sub"><div class="nav-sub-cont clearfix">';if(child_category.length>0){var c_c_title=child_category[0].tag;var c_c_detail=child_category[0].nodes;str_category+='<div class="nav-sub-item">';for(var m=0;m<c_c_title.length;m++){str_category+="<h3>"+c_c_title[m].elementName+"</h3>"}if(c_c_detail.length>0){str_category+="<p>";var c_c_detail_link_parent=c_c_detail[0];var c_c_detail_link_tag=c_c_detail[0].tag;if(c_c_detail_link_tag.length>0){for(var n=0;n<c_c_detail_link_tag.length;n++){var detail_link=c_c_detail_link_tag[n];str_category+='<a href="'+detail_link.linkUrl+'" target="_blank" name="'+detail_link.trickPoint+'">'+detail_link.elementName+"</a>"}}str_category+="</p>"}str_category+="</div>"}str_category+="</div></dd>"}str_category+="</dl>"}}navs.html(str_category);var str_otherWords="";if(otherWords.length){str_otherWords='<a href="'+otherWords[0].linkUrl+'" target="_blank" name="'+otherWords[0].trickPoint+'" rel="nofollow">'+otherWords[0].elementName+"</a>";str_otherWords+='<a class="aboutus" href="'+otherWords[1].linkUrl+'" target="_blank" name="'+otherWords[1].trickPoint+'" rel="nofollow">'+otherWords[1].elementName+"</a>"}$(".gnav .nav-other").html(str_otherWords)}};overseas.searchHead=function(){var input=$("#oversearchKeywords");var dOverheadSearchResults=$("#overheadSearchResults");input.focus(function(){input.css("color","#333");var value=input.val();if(value==overseas.ajaxfn.serchDefaultKeywordShow){input.val("")}});input.blur(function(){var value=input.val();if(value==""){input.val(overseas.ajaxfn.serchDefaultKeywordShow);input.css("color","#bbb")}else{input.val(value)}});input.click(function(event){event.stopPropagation();var nowTime=new Date().getTime();if(nowTime-overseas.ajaxfn.lastGetHistroyTime>300){overseas.ajaxfn.lastGetHistroyTime=nowTime;overseas.ajaxfn.getHistroy()}if(overseas.ajaxfn.isDelAll==1){overseas.ajaxfn.sureDelAll()}if(overseas.ajaxfn.searchHotKeyWordsIsReady==0){overseas.ajaxfn.getSearchHotKeyWords()}dOverheadSearchResults.show()})};overseas.search=function(){var dOverheadSearchResults=$("#overheadSearchResults");var onSubmitSearch=function(type){var obj,tmp,type=type||0;obj=$("#oversearchKeywords");tmp=$.trim(obj.val());if(tmp=="搜海外购"){tmp="海外购"}if(tmp==""||tmp==overseas.ajaxfn.serchDefaultKeywordShow){tmp=overseas.ajaxfn.serchDefaultKeyword}tmp=CtoH(tmp);var url=sn.searchDomain.replace("emall/","")+encodeURIComponent(resolveStr(tmp));var cityId=d("cityId")||"9173";url+="/cityId="+cityId;if(type==0){url+="&ch=3"}if(type==0){window.location.href=url}else{window.open(url)}return false};function resolveStr(str){str=str.replace(/\-/g,"%2d");str=str.replace(/\&/g,"%26");str=str.replace(/\./g,"%2E");str=str.replace(/\+/g,"%2B");return str}function CtoH(val){var str=val;var result="";for(var i=0;i<str.length;i++){if(str.charCodeAt(i)==12288){result+=String.fromCharCode(str.charCodeAt(i)-12256);continue}if(str.charCodeAt(i)>65280&&str.charCodeAt(i)<65375){result+=String.fromCharCode(str.charCodeAt(i)-65248)}else{result+=String.fromCharCode(str.charCodeAt(i))}}return result}$("#oversearchSubmit").on("click",function(){onSubmitSearch()});$("#oversearchKeywords").keydown(function(event){if(event.which==13){$("#oversearchSubmit").click();return false}});$("#oversearchAllsearchSubmit").on("click",function(){onSubmitSearch(1)});dOverheadSearchResults.mouseenter(function(){$(this).show()});var dHistoryResults=dOverheadSearchResults.find(".history-results");dHistoryResults.delegate(".history-content","hover",function(){if(!$(this).hasClass("title")){$(this).addClass("active").siblings().removeClass("active")}});dHistoryResults.delegate(".del-fn","click",function(event){event.stopPropagation();if($(this).hasClass("del-all")){overseas.ajaxfn.histroyDelAll()}else{if($(this).hasClass("del-one")){var content=$.trim($(this).siblings(".name-box").find(".name").html());overseas.ajaxfn.histroyDelOne(content,$(this))}}});dHistoryResults.delegate(".cancel-del","click",function(event){event.stopPropagation();overseas.ajaxfn.isDelAll=0;dHistoryResults.html(overseas.ajaxfn.cacheHtml)});dOverheadSearchResults.find(".close").click(function(){if(overseas.ajaxfn.isDelAll==1){overseas.ajaxfn.sureDelAll()}dOverheadSearchResults.hide()});$(window).scroll(function(){if(overseas.ajaxfn.isDelAll==1){overseas.ajaxfn.sureDelAll()}dOverheadSearchResults.hide()});$("body").click(function(){if(overseas.ajaxfn.isDelAll==1){overseas.ajaxfn.sureDelAll()}dOverheadSearchResults.hide()})};overseas.getDomain={getEnv:function(){var ego_pre_reg=/^(\w*)(pre)(\w*)(.cnsuning.com)$/,ego_sit_reg=/^(\w*)([^2]sit)(\w*)(.cnsuning.com)$/,ego_sit2_reg=/^(\w*)(2sit)(\w*)(.cnsuning.com)$/,_hostName=window.location.hostname;if(ego_pre_reg.test(_hostName)){return"pre"}else{if(ego_sit_reg.test(_hostName)){return"sit"}else{if(ego_sit2_reg.test(_hostName)){return"sit2"}}}return"prd"},setDomain:function(){var _this=this;switch(_this.getEnv()){case"prd":_this.domains={"ajaxfn":"http://ds.suning.cn/","search":"http://search.suning.com/"};break;case"pre":_this.domains={"ajaxfn":"http://dspre.cnsuning.com/","search":"http://searchpre.cnsuning.com/"};break;case"sit":_this.domains={"ajaxfn":"http://dssit.cnsuning.com/","search":"http://searchsit.cnsuning.com/"};break;case"sit2":_this.domains={"ajaxfn":"http://dssit.cnsuning.com/","search":"http://searchsit.cnsuning.com/"};break}}};overseas.ajaxfn={"init":function(){overseas.getDomain.setDomain();this.custno=d("custno")||"";this.getHot();this.getHistroy()},"custno":"","getHot":function(){$.ajax({url:overseas.getDomain.domains.ajaxfn+"ds/hotkeywords/22010--overseas.ajaxfn.hotReturn.jsonp",dataType:"jsonp",success:function(){},error:function(){}})},"hotReturn":function(re){if(typeof re!=undefined&&re&&re!="undefined"){var dOverheadSearch=$(".overhead-search");var cityId=d("cityId")||"9173";if(typeof re.keywords!=undefined&&re.keywords&&re.keywords!="undefined"){var hotwrodsHtml="";for(var i=0,keyLen=re.keywords.length;i<keyLen;i++){if(i>4){break}if(typeof re.keywords[i]["keyword"]!=undefined&&re.keywords[i]["keyword"]&&re.keywords[i]["keyword"]!="undefined"&&typeof re.keywords[i]["urlKeyword"]!=undefined&&re.keywords[i]["urlKeyword"]&&re.keywords[i]["urlKeyword"]!="undefined"){var isHighlight="";if(typeof re.keywords[i]["highlight"]!=undefined&&re.keywords[i]["highlight"]&&re.keywords[i]["highlight"]!="undefined"&&re.keywords[i]["highlight"]==true){isHighlight='style="color:#775dcf;"'}hotwrodsHtml+='<a href="'+overseas.getDomain.domains.search+re.keywords[i]["urlKeyword"]+"/cityId="+cityId+'&ch=3" target="_blank" '+isHighlight+">"+re.keywords[i]["keyword"]+"</a>"}}dOverheadSearch.find(".overhead-search-hotwrods-box").html(hotwrodsHtml)}if(typeof re.defaultKeyword!=undefined&&re.defaultKeyword&&re.defaultKeyword!="undefined"&&typeof re.defaultKeywordShow!=undefined&&re.defaultKeywordShow&&re.defaultKeywordShow!="undefined"){var searchKeywordsHidden=$("#searchKeywordsHidden").val();var nowSearchShowVal="";if(typeof searchKeywordsHidden!="undefined"&&searchKeywordsHidden!=""){this.isAlreadyResearch=searchKeywordsHidden;nowSearchShowVal=searchKeywordsHidden}else{nowSearchShowVal=re.defaultKeywordShow}$("#oversearchKeywords").val(nowSearchShowVal);this.serchDefaultKeyword=re.defaultKeyword;this.serchDefaultKeywordShow=re.defaultKeywordShow}}overseas.searchHead()},"isAlreadyResearch":"","serchDefaultKeyword":"","serchDefaultKeywordShow":"","lastGetHistroyTime":0,"getHistroy":function(){var _this=this;if(_this.isDelAll==1){return}if(_this.custno==""){var histroyHtml="";histroyHtml+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>';$("#overheadSearchResults .history-results").html(histroyHtml);return}$.ajax({url:overseas.getDomain.domains.ajaxfn+"ds/his/ext/"+_this.custno+"--4-overseas.ajaxfn.histroyReturn.jsonp",dataType:"jsonp",success:function(re){},error:function(){}})},"histroyReturn":function(re){var histroyHtml="";var cityId=d("cityId")||"9173";if(typeof re!=undefined&&re&&re!="undefined"&&typeof re.rs!=undefined&&re.rs&&re.rs!="undefined"){histroyHtml+='<li class="title"><span class="name">最近搜过</span><a class="r del-fn del-all" href="javascript:void(0);"><span class="del-icon"></span>清空</a></li>';var rsLen=re.rs.length;if(rsLen>0){for(var i=0;i<rsLen;i++){if(i>11){break}if(typeof re.rs[i]["keyname"]!=undefined&&re.rs[i]["keyname"]&&re.rs[i]["keyname"]!="undefined"){histroyHtml+='<li class="history-content"><a class="name-box" href="'+overseas.getDomain.domains.search+re.rs[i]["keyname"]+"/cityId="+cityId+'&ch=3"><span class="name">'+re.rs[i]["keyname"]+'</span></a><span class="del-icon del-fn del-one"></span></li>'}}}else{histroyHtml='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>'}}else{histroyHtml+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>'}$("#overheadSearchResults .history-results").html(histroyHtml)},"histroyDelOne":function(keyword,target){var _this=this;var keyword=keyword||"";_this.histroyDelOneTarget=target;if(_this.custno==""||keyword==""){return}$.ajax({url:overseas.getDomain.domains.ajaxfn+"ds/his/ext/del/"+_this.custno+"-"+keyword+"-4-overseas.ajaxfn.histroyDelReturn.jsonp",dataType:"jsonp",success:function(re){},error:function(){}})},"histroyDelOneTarget":"","histroyDelReturn":function(re){if(typeof re!=undefined&&re&&re!="undefined"&&typeof re.rs!=undefined&&re.rs&&re.rs!="undefined"&&re.rs==="T"){this.histroyDelOneTarget.parent(".history-content").remove()}},"histroyDelAll":function(){var _this=this;_this.isDelAll=1;var dHistoryResults=$("#overheadSearchResults .history-results");_this.cacheHtml=dHistoryResults.html();var warningHtml='<li class="title gray"><span class="name">你的历史记录已被清空</span><a class="cancel-del">撤销</a></li><li class="history-no-data"></li>';dHistoryResults.html(warningHtml)},"histroyDelAllReturn":function(re){var _this=this;_this.isDelAll=0},"cacheHtml":"","isDelAll":0,"sureDelAll":function(){var _this=this;var histroyHtml="";histroyHtml+='<li class="title gray"><span class="name">最近搜索</span></li><li class="history-no-data"></li>';$("#overheadSearchResults .history-results").html(histroyHtml);$.ajax({url:overseas.getDomain.domains.ajaxfn+"ds/his/ext/clean/"+_this.custno+"-overseas.ajaxfn.histroyDelAllReturn.jsonp",dataType:"jsonp",success:function(re){},error:function(){_this.isDelAll=0}})},"searchHotKeyWordsIsReady":0,"getSearchHotKeyWords":function(){this.searchHotKeyWordsIsReady=1;$.ajax({url:overseas.getDomain.domains.ajaxfn+"ds/searchHotkeywords/22010-overseas.ajaxfn.searchHotKeyWordsReturn.jsonp",dataType:"jsonp",success:function(re){},error:function(){}})},"searchHotKeyWordsReturn":function(re){var hotKeyWordsHtml="";var cityId=d("cityId")||"9173";hotKeyWordsHtml+='<li class="title"><span class="name">正在热搜中</span><a href="javascript:void(0);" class="close">X</a></li>';if(typeof re!=undefined&&re&&re!="undefined"){for(var i=0,keywordLen=re.length;i<keywordLen;i++){hotKeyWordsHtml+='<li><a class="rec-results-content" href="'+overseas.getDomain.domains.search+re[i]["urlKeyword"]+"/cityId="+cityId+'&ch=3" target="_blank">'+re[i]["keyword"]+"</a></li>"}}$("#overheadSearchResults .rec-results").html(hotKeyWordsHtml)}};overseas.countries=function(){$(".gnav-main .nav .more-country").hover(function(){$(this).addClass("country-hover");if(!isIE6){$(this).find(".country-list").stop(true,true).slideDown()}else{$(this).find(".country-list").show()}},function(){$(this).removeClass("country-hover");if(!isIE6){$(this).find(".country-list").stop(true,true).slideUp()}else{$(this).find(".country-list").hide()}})};$(function(){overseas.flag();overseas.search();overseas.getNavs();overseas.ajaxfn.init();overseas.countries()});