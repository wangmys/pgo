var cartListLoop=cartListLoop||{};cartListLoop.listloop=function(opt){var _opt={wrap:"",loopBox:"",triggerLeft:".prev",triggerRight:".next",curCount:".cur-count",totalCount:".total-count",step:{wide:4,narrow:4},scrollWidth:{wide:580,narrow:580},hasCount:true,isLoop:true,isLazyLoad:true,delay:0,hasLabel:false,labelObj:null,vertical:false,isRandom:false,itemNum:null,hoverArr:false};$.extend(_opt,opt);var box=$(_opt.wrap),leftCtrl=box.find(_opt.triggerLeft),rightCtrl=box.find(_opt.triggerRight),moveBox=box.find(_opt.loopBox),moveBoxLi=moveBox.find(".list:not(.hide)"),step=_opt.step.wide,scrollWidth=_opt.scrollWidth.wide,len=Math.ceil(moveBoxLi.length/step),liLen=moveBoxLi.length,curCount=box.find(_opt.curCount),totalCount=box.find(_opt.totalCount),i=0;if(screen.width<1280){step=_opt.step.narrow;scrollWidth=_opt.scrollWidth.narrow;var _step=moveBoxLi.length%step;len=Math.ceil(moveBoxLi.length/step);liLen=moveBoxLi.length-_step}_opt.hasCount&&totalCount.html(len);leftCtrl.unbind().click(function(){prev()});rightCtrl.unbind().click(function(){next()});if(liLen>step){leftCtrl.show();rightCtrl.show()}else{leftCtrl.hide();rightCtrl.hide()}if(liLen>step&&_opt.hoverArr){box.hover(function(){leftCtrl.show();rightCtrl.show()},function(){leftCtrl.hide();rightCtrl.hide()})}var pager=opt.labelObj,pagerDom="",pageri;if(pager){if(len<=1){pager.hide()}pager.find(".prev").unbind().click(function(){prev()});pager.find(".next").unbind().click(function(){next()});for(pageri=0;pageri<len;pageri++){pagerDom+="<li></li>"}pager.find("ul").html(pagerDom).find("li").click(function(){i=$(this).index();move(false,i)}).first().addClass("current")}function next(){if(len==1||moveBox.is(":animated")){return false}if(!_opt.isLoop){i++;if(i>=len){i=len-1}move(false,i);return}if(i==len-1){for(var j=0;j<step;j++){if(_opt.vertical){moveBoxLi.eq(j).css({position:"relative",top:len*scrollWidth+"px"})}else{moveBoxLi.eq(j).css({position:"relative",left:len*scrollWidth+"px"})}}}i++;move(function(){if(i==len){i=0;moveBoxLi.removeAttr("style");if(_opt.vertical){moveBox.css("top",i*scrollWidth)}else{moveBox.css("left",i*scrollWidth)}}},i)}function prev(){if(len==1||moveBox.is(":animated")){return false}if(!_opt.isLoop){i--;if(i<=0){i=0}move(false,i);return}if(i==0){for(var j=1;j<=step;j++){if(_opt.vertical){moveBoxLi.eq(liLen-j).css({position:"relative",top:-len*scrollWidth+"px"})}else{moveBoxLi.eq(liLen-j).css({position:"relative",left:-len*scrollWidth+"px"})}}}i--;move(function(){if(i==-1){i=len-1;moveBoxLi.removeAttr("style");if(_opt.vertical){moveBox.css("top",-i*scrollWidth)}else{moveBox.css("left",-i*scrollWidth)}}},i)}function move(callback,_index){lazyImg();if(_opt.hasCount){if(_index>len-1){_index=0}if(_index<0){_index=len-1}curCount.html(_index+1)}if(!callback){callback=function(){}}if(_opt.vertical){moveBox.stop(true).animate({top:-i*scrollWidth},300,callback)}else{moveBox.stop(true).animate({left:-i*scrollWidth},300,callback)}chooseLabel(i==len?0:i);if(pager){pager.find("li").removeClass("current").eq(i==len?0:i).addClass("current")}}function lazyImg(){if(!_opt.isLazyLoad){return}for(var j=0;j<step;j++){var _thisImg=moveBoxLi.eq(i*step+j).find("img[src3]");_thisImg.each(function(){var _this=$(this);_this.attr("src",_this.attr("src3")).removeAttr("src3").addClass("err-product")})}}function createLabel(){var dom=[],j,timer;dom.push('<div class="page-list"><ul>');for(j=1;j<=len;j++){dom.push("<li"+(j==1?' class="current"':"")+"></li>")}dom.push("</ul></div>");var pager=$(dom.join("")).appendTo(box);pager.find("li").hover(function(){var index=$(this).index(),begin=index*step,over=(index+1)*step;timer=setTimeout(function(){for(var n=begin;n<over;n++){moveBox.find("li").eq(n).find("img[src3]").each(function(){var _this=$(this);_this.attr("src",_this.attr("src3")).removeAttr("src3").addClass("err-product")})}moveBox.stop(true).animate({left:-index*scrollWidth},300);chooseLabel(index);if(_opt.hasCount){curCount.html(index+1)}i=index},100)},function(){clearTimeout(timer)})}function chooseLabel(i){box.find(".page-list li").removeClass("current").eq(i).addClass("current")}if(_opt.hasLabel&&len>1){createLabel()}if(_opt.delay){var auto=setInterval(function(){next()},_opt.delay);box.hover(function(){clearInterval(auto)},function(){auto=setInterval(function(){next()},_opt.delay)})}if(_opt.isRandom){var random=Math.floor(Math.random()*len),begin=random*step,over=(random+1)*step;for(var n=begin;n<over;n++){moveBox.find("li").eq(n).find("img[src3]").each(function(){var _this=$(this);_this.attr("src2",_this.attr("src3")).removeAttr("src3").addClass("err-product")})}chooseLabel(random);moveBox.stop(true).animate({left:-random*scrollWidth},300);i=random}};